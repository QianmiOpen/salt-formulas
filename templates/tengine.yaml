name: tengine
remark: 用于tengine项目的自动部署
items:
actions:
  - name: 部署tengine
    css: glyphicon glyphicon-import
    steps:
      - name: 加固os
        sls: "salt {{cHost.name}} state.sls saltenv='{{env.scriptVersion}}' os.security"
      - name: 安装ntp服务
        sls: "salt {{cHost.name}} state.sls saltenv='{{env.scriptVersion}}' ntp"
      - name: 编译安装tengine
        sls: "salt {{cHost.name}} state.sls saltenv='{{env.scriptVersion}}' tengine"

  - name: 重启tengine
    css: glyphicon glyphicon-repeat
    steps:
      - name: 重启tengine
        sls: "salt {{cHost.name}} state.sls saltenv='{{env.scriptVersion}}' tengine.reload"

  - name: 启动应用
    css: glyphicon glyphicon-play
    steps:
      - name: 启动应用
        sls: "salt {{cHost.name}} state.sls saltenv='{{env.scriptVersion}}' tengine.start"

  - name: 停止应用
    css: glyphicon glyphicon-stop
    steps:
      - name: 关闭应用
        sls: "salt {{cHost.name}} state.sls saltenv='{{env.scriptVersion}}' tengine.stop"

  - name: 配置文件检查
    css: glyphicon glyphicon-check
    steps:
      - name: 配置文件检查
        sls: "salt {{cHost.name}} state.sls saltenv='{{env.scriptVersion}}' tengine.testconf"
