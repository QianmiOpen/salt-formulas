{%- from 'keepalived/settings.sls' import keepalived with context %}
global_defs {
   router_id redis-dubbo
}


vrrp_script chk_dubbo {
       script "/etc/keepalived/check_redis.sh 6379"  # connects and exits
       interval 2                        # check every second
       #weight -10                         # default prio: -2 if connect fails
}


vrrp_instance dubbo {
    state BACKUP
    interface eth0
    virtual_router_id 166
    priority 200
    #nopreempt
    dont_track_primary
    authentication {
        auth_type PASS
        auth_pass FuzaDeyIBidiaozao51
    }
    virtual_ipaddress {
        {{ keepalived.virtual_ipaddress }}
    }
    track_script {
       chk_dubbo
    }
     notify_master "/usr/local/bin/redis-cli -p 6379  slaveof no one"
}
